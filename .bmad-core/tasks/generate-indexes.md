<!-- Powered by BMAD™ Core -->

# Generate Indexes Task

## Purpose

To automatically generate `index.md` files for KDD (Knowledge-Driven Development) directories from document frontmatter metadata, eliminating manual TOC maintenance burden. This task implements Lisa's `*regenerate-indexes` command and ensures all knowledge assets are discoverable.

## SEQUENTIAL Task Execution (Do not proceed until current Task is complete)

### 0. Pre-Generation Setup

- Load `.bmad-core/core-config.yaml` from the project root
- Load taxonomy: `.bmad-core/data/kdd-taxonomy.yaml`
- Identify KDD directories to index:
  - `docs/kdd/patterns/`
  - `docs/kdd/learnings/` (including subdirectories)
  - `docs/kdd/decisions/`
  - `docs/examples/`
- Initialize generation counters:
  - Indexes generated
  - Documents indexed
  - Documents skipped (parse errors)

### 1. Scan Documents and Extract Metadata

- **For each KDD directory** (patterns/, learnings/, decisions/, examples/):
  - List all `.md` files (excluding `index.md` itself)
  - **For each document**:
    - Read frontmatter metadata (YAML or Markdown headers)
    - Extract required fields based on document type (from kdd-taxonomy.yaml):
      - **Pattern**: domain, topic, status, created date, brief description
      - **Learning**: topic, issue, created date, story reference, brief description
      - **Decision**: ADR number, title, status, created date, brief description
      - **Example**: purpose, related patterns, brief description
    - Extract first paragraph or description for index entry
    - Store document info: `{filename, title, description, metadata}`
  - **If document has parse errors**: Skip and log warning: "Skipped {path} (invalid frontmatter)"
  - **If no description found**: Use filename as fallback title

### 2. Sort Documents by Type

- **For patterns directory** (`docs/kdd/patterns/`):
  - Sort by domain, then topic (alphabetical)
  - Group by domain if >10 patterns exist
- **For learnings directory** (`docs/kdd/learnings/`):
  - Sort by subdirectory (deployment/, debugging/, etc.), then topic
  - Within subdirectory, sort by created date (newest first)
- **For decisions directory** (`docs/kdd/decisions/`):
  - Sort by ADR number (ascending: ADR-001, ADR-002, ...)
  - Group by year if >20 ADRs exist
- **For examples directory** (`docs/examples/`):
  - Sort alphabetically by purpose

### 3. Generate Index Content

- **Create index.md structure** for each directory:

  **Header**:
  ```markdown
  # {Directory Name} Index

  > Auto-generated by Lisa (Librarian) on {timestamp}
  > Total documents: {count}

  {Brief description of directory purpose}
  ```

  **Document Listing**:
  - **For patterns**:
    ```markdown
    ## {Domain} Patterns

    - **[{Pattern Title}](./{filename}.md)** - {Brief description}
      - Story reference: Story {number}
      - Status: {Active | Deprecated | Under Review}
    ```
  - **For learnings**:
    ```markdown
    ## {Subdirectory Name}

    - **[{Learning Title}](./{filename}.md)** - {Brief description}
      - Story: {story-reference}
      - Date: {created-date}
    ```
  - **For decisions**:
    ```markdown
    ## Architecture Decision Records

    - **[ADR-{number}: {Title}](./{filename}.md)** - {Brief description}
      - Status: {Accepted | Proposed | Deprecated | Superseded}
      - Date: {created-date}
    ```
  - **For examples**:
    ```markdown
    - **[{Example Title}](./{filename})** - {Purpose}
      - Related: {related-patterns-links}
    ```

  **Footer**:
  ```markdown
  ---

  **Index Maintenance**: This index is auto-generated by Lisa. Run `*regenerate-indexes` to update.
  ```

### 4. Write Index Files

- **For each directory with documents**:
  - Write `{directory}/index.md` with generated content
  - If index.md already exists, overwrite it (auto-generated, not manually maintained)
  - Set file permissions appropriately (readable by all)
  - Log: "Generated {path}/index.md ({doc-count} documents indexed)"
- **If directory has subdirectories** (e.g., `docs/kdd/learnings/deployment/`):
  - Generate index.md for parent directory listing subdirectories
  - Generate index.md for each subdirectory listing documents within
  - Cross-link parent and child indexes

### 5. Validate Generated Indexes

- **For each generated index.md**:
  - Verify file was written successfully
  - Verify all document links are valid (relative paths correct)
  - Verify no broken links in generated index
  - Check for duplicate entries (should not happen, but validate)
- **If validation fails**:
  - Log error: "Index generation failed for {path}: {reason}"
  - Suggest manual review

### 6. Display Generation Summary

- **Report results**:
  ```
  ✅ Index generation complete

  Indexes Generated:
  - docs/kdd/patterns/index.md ({pattern-count} patterns)
  - docs/kdd/learnings/index.md ({learning-count} learnings)
    - docs/kdd/learnings/deployment/index.md ({count} documents)
    - docs/kdd/learnings/debugging/index.md ({count} documents)
    - [additional subdirectories...]
  - docs/kdd/decisions/index.md ({decision-count} ADRs)
  - docs/examples/index.md ({example-count} examples)

  Total Documents Indexed: {total-count}
  Documents Skipped: {skip-count} (parse errors or missing metadata)

  Next: Run `*validate-topology` to verify index health.
  ```

### 7. Optional: Cross-Link Indexes

- **If user requests comprehensive index** (optional):
  - Generate root `docs/kdd/index.md` linking to all subdirectory indexes
  - Include section: "Quick Navigation"
  - Link to patterns, learnings, decisions, examples indexes
  - Include high-level statistics (total patterns, learnings, ADRs, examples)

## Error Handling

- **If directory does not exist**: Create it, then generate empty index: "No documents found in {path}"
- **If document frontmatter missing**: Use filename as title, log warning
- **If file write fails**: HALT with error: "Could not write {path}/index.md: {reason}"
- **If kdd-taxonomy.yaml not found**: Use default document structure

## Graceful Degradation

- Documents with incomplete metadata included with fallback title (filename)
- Parse errors skip document, continue generation (log warnings)
- Missing subdirectories ignored (only index existing directories)
- Index generation failures non-blocking (report error, continue with other directories)

## Notes

- This task eliminates 13+ manual TOC updates per 3 months (SupportSignal evidence)
- Auto-generated indexes are never manually edited (always regenerate)
- Run `*regenerate-indexes` after:
  - Creating new KDD documents
  - Reorganizing directory structure
  - Completing an epic (bulk knowledge curation)
- Integration with `*validate-topology` to verify index health after generation
