# Story 3.9 - Acceptance Test Guide

## Quick Summary

**Story**: Add Capability Explorer Command to Victor Agent
**Status**: Ready for Review
**Test Focus**: Victor agent gains `*capability-explorer` command that queries POEM capabilities from 4 data sources (Victor artifacts, Story files, KDD docs, Epic Capabilities) with natural language support and fast response times (<3s).

## Prerequisites

**Before testing, ensure:**

- [x] Story status is "Ready for Review"
- [ ] Node.js 22.x LTS installed
- [ ] All dependencies installed (`npm install` from project root)
- [ ] Project built successfully (`npm run build` from project root)
- [ ] Development environment set up (POEM_DEV=true in packages/poem-app/.env)
- [ ] Familiar with Victor agent location: `.claude/commands/poem/agents/victor.md`

**Environment Setup:**

- Node.js: 22.x LTS
- TypeScript: 5.9.x
- Working directory: `/Users/davidcruwys/dev/ad/poem-os/poem`
- Test framework: Vitest 4.x

---

## ðŸ§‘ Human Tests (Visual/Manual)

Tests requiring human observation - reading documentation, observing command behavior, verifying visual formatting.

### Test 1: AC1 - Victor Agent Has New Command

**What to test**: Victor agent gains `*capability-explorer` command that accepts natural language queries

**Steps**:

1. Open file `.claude/commands/poem/agents/victor.md` in your editor
2. Navigate to the `commands:` section in the YAML block (around line 88-100)
3. Look for the `capability-explorer` command entry
4. Read the command description

**Expected Result**:
âœ… Victor agent definition updated with new command:

- Command name: `capability-explorer` is listed in the commands section
- Description reads: "Query POEM capabilities (natural language supported) - secondary skill, not core validation"
- Command appears in the list alongside other Victor commands (validate, regression, etc.)

**Evidence**:

- Screenshot or visual confirmation that line 99 contains the capability-explorer command
- Command description clearly states it's a "secondary skill" (not core validation)

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test 2: AC9 - Victor Agent Definition Updated

**What to test**: Victor agent definition updated with new command documentation

**Steps**:

1. Continue reading `.claude/commands/poem/agents/victor.md`
2. Scroll to the "Agent Behavior" section (line 116+)
3. Look for documentation about the `*capability-explorer` command
4. Check if usage examples are provided

**Expected Result**:
âœ… Victor agent documentation includes:

- Section explaining the `*capability-explorer` command
- Usage examples showing query syntax
- Natural language query examples (e.g., "can POEM do X?", "list all capabilities")
- Documentation of query types: list all, can-do, find-similar, find-blockers

**Evidence**:

- Visual confirmation of command documentation
- Note which line number the documentation starts at

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test 3: AC10 - Technical Debt Documented

**What to test**: Technical debt documented: "Extract to Capability Explorer agent if complexity exceeds 20% of Victor's code"

**Steps**:

1. Search the file `.claude/commands/poem/agents/victor.md` for "technical debt" or "20%" or "Capability Explorer agent"
2. Look for comments or documentation about extraction plan
3. Verify extraction trigger is documented (20% threshold)
4. Check if Epic 6 is mentioned as extraction timeline

**Expected Result**:
âœ… Technical debt clearly documented:

- Mentions this is a "temporary enhancement"
- Specifies extraction trigger: Query logic exceeds 20% of Victor's codebase
- Documents extraction plan: Create dedicated Capability Explorer agent in Epic 6
- Notes this is a stopgap solution, not permanent architecture

**Evidence**:

- Quote the exact text documenting the technical debt
- Note location in file (line number or section)

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test 4: AC11 - Help System Updated

**What to test**: Help system updated to include `*capability-explorer` command description

**Steps**:

1. In `.claude/commands/poem/agents/victor.md`, locate the `commands:` section
2. Verify `capability-explorer` is listed with description
3. Check if the command will appear when `*help` is run by Victor agent
4. Read the description to ensure it's clear and helpful

**Expected Result**:
âœ… Help system includes new command:

- `capability-explorer` appears in the commands list
- Description is clear and mentions "natural language supported"
- Command is marked as "secondary skill" to distinguish from core validation
- Description guides users on when to use it

**Evidence**:

- Visual confirmation command is in the YAML commands list
- Description text is helpful and accurate

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test 5: AC12 - Optional Command, No Interference

**What to test**: Query command is optional and does not interfere with Victor's primary validation role

**Steps**:

1. Review Victor agent definition in `.claude/commands/poem/agents/victor.md`
2. Check that primary validation commands are still present (validate, regression, progression, integration)
3. Verify `capability-explorer` is listed AFTER core validation commands
4. Read the description to confirm it's marked as "secondary skill"

**Expected Result**:
âœ… Command positioning and documentation shows:

- Core validation commands (validate, regression, progression, integration) come BEFORE capability-explorer
- capability-explorer description includes "secondary skill, not core validation"
- Victor's primary role description (lines 60-73) unchanged - still "Product Integration QA - Multi-Story Context Keeper"
- No changes to validation workflows or core behavior

**Evidence**:

- Command order in commands list
- Primary role description intact
- "secondary skill" label present

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test 6: AC4 - Status Indicators in Code

**What to test**: Returns results with capability status indicators (âœ… Functional, ðŸ”„ In Progress, ðŸ“… Planned, âš ï¸ Partial, âŒ Not Available)

**Steps**:

1. Open `packages/poem-core/utils/capability-reader.ts` in your editor
2. Find the `CapabilityRecord` interface (around line 14-31)
3. Check the `status` field type definition
4. Verify all 5 status indicators are included

**Expected Result**:
âœ… Status field includes all 5 indicators:

- Type definition: `status: 'âœ…' | 'ðŸ”„' | 'ðŸ“…' | 'âš ï¸' | 'âŒ';`
- All emoji symbols present
- No additional status values
- Type is a union of literal types (TypeScript type safety)

**Evidence**:

- Screenshot or visual confirmation of the interface definition
- Exact line number where status field is defined

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test 7: AC7 - Practical Usage Information in Code

**What to test**: Results include practical usage information: commands to use, examples, documentation links

**Steps**:

1. Continue reading `packages/poem-core/utils/capability-reader.ts`
2. Find the `usage` field in `CapabilityRecord` interface
3. Verify it includes commands, examples, and docs arrays
4. Check the `kddLinks` field structure

**Expected Result**:
âœ… Interface includes usage fields:

- `usage?` field with structure: `{ commands: string[]; examples: string[]; docs: string[]; }`
- `kddLinks?` field with structure: `{ patterns: string[]; learnings: string[]; decisions: string[]; }`
- Both fields are optional (marked with `?`)
- Type-safe string arrays

**Evidence**:

- Visual confirmation of field structure
- Note line numbers for usage and kddLinks fields

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test 8: AC3 - Query Types in Code

**What to test**: Supports query types: "list all", "can POEM do X?", "find similar to X", "what's blocking story Y?"

**Steps**:

1. Open `packages/poem-core/utils/query-engine.ts` in your editor
2. Look for query type handling logic
3. Search for function names or comments mentioning the 4 query types
4. Verify all 4 types are implemented

**Expected Result**:
âœ… Code implements all 4 query types:

- List all capabilities query
- Can-do query (exact match + near-matches)
- Find similar query (keyword matching with similarity scores)
- Find blockers query (story dependency resolution)
- Clear separation between query types in code
- Natural language parsing support

**Evidence**:

- Note function names or sections for each query type
- Visual confirmation all 4 types present

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

## ðŸ¤– Terminal Tests (Scriptable)

Tests using command-line tools - copy-paste ready commands.

### Test A: AC2 - Data Sources - Victor Artifacts

**What to test**: Capability reader can read from Victor artifacts

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- capability-reader.test.ts -t "reads Victor artifacts"
```

**Expected Output**:

```
âœ“ reads Victor artifacts from integration-matrix.md
âœ“ gracefully handles missing Victor artifacts
```

**Validation**:

- âœ… Test passes for reading Victor artifacts
- âœ… Test passes for graceful degradation when files missing
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: All 10 tests in capability-reader.test.ts passed. Graceful degradation verified.

---

### Test B: AC2 - Data Sources - Story Files

**What to test**: Capability reader can read from Story files

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- capability-reader.test.ts -t "reads Story files"
```

**Expected Output**:

```
âœ“ reads Story files (Status, Acceptance Criteria)
âœ“ parses story status correctly
âœ“ extracts acceptance criteria from story
```

**Validation**:

- âœ… Test passes for reading story files
- âœ… Test passes for status parsing
- âœ… Test passes for AC extraction
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: Tests passed - story file reading, status parsing, and AC extraction all working.

---

### Test C: AC2 & AC6 - Data Sources - KDD Topology

**What to test**: Command reads Lisa's KDD topology (patterns, learnings, decisions) as additional context source

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- capability-reader.test.ts -t "reads KDD"
```

**Expected Output**:

```
âœ“ reads KDD topology (patterns/, learnings/, decisions/)
âœ“ extracts KDD links from documents
âœ“ gracefully handles missing KDD directories
```

**Validation**:

- âœ… Test passes for reading KDD patterns
- âœ… Test passes for reading KDD learnings
- âœ… Test passes for reading KDD decisions
- âœ… Graceful handling when KDD docs missing
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: KDD topology reading confirmed - patterns, learnings, decisions all accessible. Graceful degradation verified.

---

### Test D: AC2 - Data Sources - Epic Capabilities

**What to test**: Capability reader can read from Epic Capabilities document

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- capability-reader.test.ts -t "reads Epic Capabilities"
```

**Expected Output**:

```
âœ“ reads Epic Capabilities from epic-capabilities.md
âœ“ parses planned capabilities from markdown table
âœ“ gracefully handles missing epic file
```

**Validation**:

- âœ… Test passes for reading epic capabilities
- âœ… Test passes for parsing markdown table
- âœ… Graceful degradation when file missing
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: Epic capabilities parsing working correctly - markdown table read and parsed successfully.

---

### Test E: AC3 - Query Type: List All

**What to test**: Query engine supports "list all" query type

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- query-engine.test.ts -t "list all"
```

**Expected Output**:

```
âœ“ handles "list all" query
âœ“ returns categorized capabilities
âœ“ groups capabilities by status
```

**Validation**:

- âœ… Test passes for "list all" query
- âœ… Results are categorized/grouped
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: All 19 tests in query-engine.test.ts passed. "List all" query working correctly.

---

### Test F: AC3 - Query Type: Can Do

**What to test**: Query engine supports "can POEM do X?" query type

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- query-engine.test.ts -t "can do"
```

**Expected Output**:

```
âœ“ handles "can do" query
âœ“ finds exact matches
âœ“ finds near-matches
âœ“ returns YES/NO result
```

**Validation**:

- âœ… Test passes for "can do" query
- âœ… Exact matching works
- âœ… Near-matching works (similarity)
- âœ… Result includes YES/NO answer
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: query-engine.test.ts includes "can do" query tests. All 19 tests passed.

---

### Test G: AC3 - Query Type: Find Similar

**What to test**: Query engine supports "find similar to X" query type

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- query-engine.test.ts -t "find similar"
```

**Expected Output**:

```
âœ“ handles "find similar" query
âœ“ returns ranked results
âœ“ includes similarity scores
âœ“ keyword matching works
```

**Validation**:

- âœ… Test passes for "find similar" query
- âœ… Results are ranked by similarity
- âœ… Similarity scores included
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: query-engine.test.ts includes "find similar" query tests. All 19 tests passed.

---

### Test H: AC3 - Query Type: Find Blockers

**What to test**: Query engine supports "what's blocking story Y?" query type

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- query-engine.test.ts -t "find blockers"
```

**Expected Output**:

```
âœ“ handles "find blockers" query
âœ“ identifies story dependencies
âœ“ returns dependency tree
âœ“ provides recommendations
```

**Validation**:

- âœ… Test passes for "find blockers" query
- âœ… Story dependencies identified
- âœ… Dependency tree structure correct
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: query-engine.test.ts includes "find blockers" query tests. All 19 tests passed.

---

### Test I: AC5 - Results Include Story References

**What to test**: Query results include story references, validation status, and KDD documentation links

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- response-formatter.test.ts -t "includes references"
```

**Expected Output**:

```
âœ“ formats results with story references
âœ“ includes validation status
âœ“ includes KDD documentation links
âœ“ story references are clickable format
```

**Validation**:

- âœ… Test passes for story references
- âœ… Validation status included
- âœ… KDD links included
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: All 13 tests in response-formatter.test.ts passed. Story references, validation status, and KDD links confirmed.

---

### Test J: AC8 - Fast Query Response

**What to test**: Fast query response (<3 seconds for typical queries)

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- capability-query-integration.test.ts -t "response time"
```

**Expected Output**:

```
âœ“ all queries complete in <3 seconds
âœ“ "list all" query is fast
âœ“ "can do" query is fast
âœ“ "find similar" query is fast
âœ“ "find blockers" query is fast
```

**Validation**:

- âœ… All query types complete in <3 seconds
- âœ… Performance tests pass
- âœ… No timeout errors
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: All 14 tests in capability-query-integration.test.ts passed. Response time <3s verified. Test duration: 346ms.

---

### Test K: All Tests Pass

**What to test**: Complete test suite passes (56/56 tests)

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm test -- capability-reader.test.ts query-engine.test.ts response-formatter.test.ts capability-query-integration.test.ts
```

**Expected Output**:

```
Test Files  4 passed (4)
     Tests  56 passed (56)
  Start at  XX:XX:XX
  Duration  XXXms
```

**Validation**:

- âœ… All 4 test files pass
- âœ… All 56 tests pass
- âœ… No failures
- âœ… No errors in terminal
- âœ… Duration is reasonable (<30 seconds)

**Status**: âœ… Passed

**Notes**: Complete test suite: 4 test files, 56 tests, all passed in 346ms. Excellent performance.

---

### Test L: Build Succeeds

**What to test**: Project builds successfully with new code

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem && npm run build
```

**Expected Output**:

```
> poem@workspace:0.0.1 build
> turbo build

â€¢ Packages in scope: @poem/app, @poem/core
â€¢ Running build in 2 packages
â€¢ Remote caching disabled

 Tasks:    2 successful, 2 total
Cached:    0 cached, 2 total
  Time:    XXs
```

**Validation**:

- âœ… Build command succeeds (exit code 0)
- âœ… Both packages (@poem/app, @poem/core) build successfully
- âœ… No TypeScript errors
- âœ… No build warnings related to new code
- âœ… No errors in terminal

**Status**: âœ… Passed

**Notes**: App build succeeded. Core package doesn't need build (exports YAML/MD files). Expected behavior.

---

## â³ Not Testable Yet

**None** - All acceptance criteria are testable with current implementation.

---

## Test Checklist

Copy this checklist to track overall progress:

**Human Tests:**

- [ ] Test 1: AC1 - Victor agent has new command
- [ ] Test 2: AC9 - Victor agent definition updated
- [ ] Test 3: AC10 - Technical debt documented
- [ ] Test 4: AC11 - Help system updated
- [ ] Test 5: AC12 - Optional command, no interference
- [ ] Test 6: AC4 - Status indicators in code
- [ ] Test 7: AC7 - Practical usage information in code
- [ ] Test 8: AC3 - Query types in code

**Terminal Tests:**

- [x] Test A: AC2 - Data sources - Victor artifacts âœ… PASSED
- [x] Test B: AC2 - Data sources - Story files âœ… PASSED
- [x] Test C: AC2 & AC6 - Data sources - KDD topology âœ… PASSED
- [x] Test D: AC2 - Data sources - Epic Capabilities âœ… PASSED
- [x] Test E: AC3 - Query type: List all âœ… PASSED
- [x] Test F: AC3 - Query type: Can do âœ… PASSED
- [x] Test G: AC3 - Query type: Find similar âœ… PASSED
- [x] Test H: AC3 - Query type: Find blockers âœ… PASSED
- [x] Test I: AC5 - Results include story references âœ… PASSED
- [x] Test J: AC8 - Fast query response âœ… PASSED
- [x] Test K: All tests pass (56/56) âœ… PASSED
- [x] Test L: Build succeeds âœ… PASSED

**Overall Status**: ðŸ”„ In Progress (Terminal tests complete, Human tests pending)

---

## Troubleshooting

### Issue: Test command not found

**Symptom**: `npm test` returns "command not found" or "script not found"
**Solution**:
1. Ensure you're in the project root directory: `/Users/davidcruwys/dev/ad/poem-os/poem`
2. Run `npm install` to ensure dependencies are installed
3. Check that `package.json` has a test script defined

### Issue: Build fails with TypeScript errors

**Symptom**: `npm run build` fails with type errors in new files
**Solution**:
1. Check that all imports are correct in the new utility files
2. Verify TypeScript version is 5.9.x: `npx tsc --version`
3. Run `npm install` to ensure dependencies are up to date
4. Check for missing type definitions

### Issue: Tests timeout or take too long

**Symptom**: Tests fail with timeout errors or take >10 seconds
**Solution**:
1. Check if file I/O operations are slow (disk performance)
2. Verify test timeout settings in vitest.config.ts
3. Run tests individually to identify slow test: `npm test -- <test-file>.test.ts`

### Issue: Cannot find Victor agent file

**Symptom**: File `.claude/commands/poem/agents/victor.md` not found
**Solution**:
1. Verify you're in the correct directory (project root)
2. Check if file exists: `ls -la .claude/commands/poem/agents/victor.md`
3. File should be in development mode location (not `.poem-core/`)

### Issue: Graceful degradation tests fail

**Symptom**: Tests for missing data sources fail instead of passing
**Solution**:
1. Check that capability-reader.ts has proper error handling
2. Verify try-catch blocks are present for file read operations
3. Ensure tests create/remove test files correctly
4. Check file permissions on test directories

---

## Test Results Summary

**Date Tested**: 2026-01-26
**Tester**: Taylor (SAT Agent)

**Automated Test Results** (Executed by Taylor):

- Terminal Tests: **12 / 12 passed** âœ…
- All 56 unit/integration tests passed
- Build successful
- Performance verified (<3s response time)

**Manual Test Results** (Pending User Execution):

- Human Tests: **0 / 8 tested** (awaiting manual execution)

**Total Progress**: 12 / 20 tests complete (60%)

**Issues Found**:

None - All automated tests passed successfully.

**Next Steps**:

User must execute the 8 Human Tests (visual verification, documentation review) to complete SAT.

**Sign-off**: ðŸ”„ Automated tests passed - Manual tests pending

---

_Generated by Taylor (SAT Guide Creator) from Story 3.9_
