# Story 1.10 - Acceptance Test Guide

## Quick Summary

**Story**: Selective Workspace Creation
**Status**: In Progress
**Test Focus**: POEM now creates workspace folders on-demand instead of all at once. Users run `poem-os init` to create the workspace, then `poem-os add-workflow <name>` to create workflow-specific folders. All `workflow-data` terminology renamed to `workflow-state`.

## Prerequisites

**Before testing, ensure:**

- [ ] Story status is "In Progress" or "Review"
- [ ] Dependencies installed (`npm install` - includes new `js-yaml` dependency)
- [ ] No existing `poem/` folder in test directory (clean slate)
- [ ] Working directory: `/Users/davidcruwys/dev/ad/poem-os/poem`

**Environment Setup:**

- Node.js: 22.x LTS
- Package Manager: npm 10.x
- Test Location: Create a temporary test directory outside the POEM repo

---

## üßë Human Tests (Visual/Manual)

Tests requiring human observation - terminal output, folder creation, file contents.

### Test 1: AC1 - Bare Installation Creates No Workspace

**What to test**: `npx poem-os install` creates ONLY `.poem-core/`, `.poem-app/`, and `.poem-preserve` (no `poem/` folder)

**Steps**:

1. Create a fresh test directory: `mkdir /tmp/poem-test-1 && cd /tmp/poem-test-1`
2. Run `npx poem-os install` (or `npm link` then `poem-os install` if testing locally)
3. Observe terminal output for installation summary
4. Run `ls -la` to see created folders

**Expected Result**:
‚úÖ Installation completes successfully with:

- `.poem-core/` directory exists
- `.poem-app/` directory exists
- `.poem-preserve` file exists
- **NO `poem/` directory** (this is the key test!)
- Terminal displays: "To get started: Run `poem-os init` to create workspace"

**Evidence**:

- Terminal screenshot showing installation summary message
- `ls -la` output showing no `poem/` folder

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 2: AC2 - Init Command Creates Root Workspace

**What to test**: `poem-os init` creates `poem/config/` with `poem.yaml` and `poem/shared/` directories

**Steps**:

1. In the same test directory from Test 1, run `poem-os init`
2. Observe terminal output for success message
3. Run `ls -R poem/` to see directory structure
4. Run `cat poem/config/poem.yaml` to view config file contents

**Expected Result**:
‚úÖ Command succeeds with:

- Success message: "‚úÖ Workspace initialized at poem/"
- Created messages for: `poem/config/poem.yaml`, `poem/shared/prompts/`, `poem/shared/schemas/`
- Directory structure:
  ```
  poem/
  ‚îú‚îÄ‚îÄ config/
  ‚îÇ   ‚îî‚îÄ‚îÄ poem.yaml
  ‚îî‚îÄ‚îÄ shared/
      ‚îú‚îÄ‚îÄ prompts/
      ‚îî‚îÄ‚îÄ schemas/
  ```
- `poem.yaml` contains:
  ```yaml
  # POEM Configuration
  version: 1.0
  currentWorkflow: null
  workflows: {}
  ```

**Evidence**:

- Terminal screenshot showing success message and created folders
- Output of `cat poem/config/poem.yaml` showing correct structure

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 3: AC2 - Init Command is Idempotent

**What to test**: Running `poem-os init` twice doesn't error, displays skip message

**Steps**:

1. In the same test directory with workspace already initialized
2. Run `poem-os init` again (second time)
3. Observe terminal output

**Expected Result**:
‚úÖ Command succeeds with:

- Skip message: "‚Ñπ Workspace already initialized. Skipped."
- No errors
- No duplicate folders created

**Evidence**:

- Terminal screenshot showing skip message

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 4: AC3 - Add Workflow Creates Workflow Folders

**What to test**: `poem-os add-workflow youtube` creates 4 workflow-specific folders with `workflow-state` terminology

**Steps**:

1. In the same test directory with workspace initialized
2. Run `poem-os add-workflow youtube`
3. Observe terminal output for success message
4. Run `ls -R poem/workflows/youtube/` to see directory structure
5. Run `cat poem/config/poem.yaml` to see updated config

**Expected Result**:
‚úÖ Command succeeds with:

- Success message: "‚úÖ Workflow 'youtube' added. Switch to it: /poem/agents/penny ‚Üí \*switch youtube"
- Created messages for 4 folders: `prompts/`, `schemas/`, `mock-data/`, `workflow-state/`
- Directory structure:
  ```
  poem/workflows/youtube/
  ‚îú‚îÄ‚îÄ prompts/
  ‚îú‚îÄ‚îÄ schemas/
  ‚îú‚îÄ‚îÄ mock-data/
  ‚îî‚îÄ‚îÄ workflow-state/   # <-- NEW terminology (not workflow-data!)
  ```
- `poem.yaml` updated with workflow definition:
  ```yaml
  currentWorkflow: youtube
  workflows:
    youtube:
      prompts: poem/workflows/youtube/prompts
      schemas: poem/workflows/youtube/schemas
      mockData: poem/workflows/youtube/mock-data
      workflowState: poem/workflows/youtube/workflow-state
  ```

**Evidence**:

- Terminal screenshot showing success message
- Output of `cat poem/config/poem.yaml` showing workflow definition with `workflowState` key

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 5: AC3 - Add Second Workflow (currentWorkflow unchanged)

**What to test**: Adding a second workflow doesn't change `currentWorkflow` in config

**Steps**:

1. In the same test directory with `youtube` workflow already added
2. Run `poem-os add-workflow nano-banana`
3. Observe terminal output
4. Run `cat poem/config/poem.yaml` to check `currentWorkflow`

**Expected Result**:
‚úÖ Command succeeds with:

- Success message for `nano-banana` workflow
- `poem.yaml` shows:
  ```yaml
  currentWorkflow: youtube  # <-- Still set to first workflow!
  workflows:
    youtube:
      # ... youtube paths
    nano-banana:
      # ... nano-banana paths
  ```

**Evidence**:

- Output of `cat poem/config/poem.yaml` showing `currentWorkflow: youtube` unchanged

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 6: AC3 - Add Workflow is Idempotent

**What to test**: Running `poem-os add-workflow youtube` twice displays skip message

**Steps**:

1. In the same test directory with `youtube` workflow already created
2. Run `poem-os add-workflow youtube` again
3. Observe terminal output

**Expected Result**:
‚úÖ Command succeeds with:

- Skip message: "‚Ñπ Workflow 'youtube' already exists. Skipped."
- No errors
- No duplicate folders created

**Evidence**:

- Terminal screenshot showing skip message

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 7: AC3 - Workflow Name Validation (Valid Names)

**What to test**: Valid workflow names are accepted (alphanumeric, dash, underscore)

**Steps**:

1. Create a fresh test directory: `mkdir /tmp/poem-test-2 && cd /tmp/poem-test-2`
2. Run `npx poem-os install` then `poem-os init`
3. Run `poem-os add-workflow test123` (alphanumeric)
4. Run `poem-os add-workflow my-workflow` (with dash)
5. Run `poem-os add-workflow my_workflow` (with underscore)
6. Run `cat poem/config/poem.yaml` to verify all workflows added

**Expected Result**:
‚úÖ All three workflows created successfully:

- `test123` workflow created
- `my-workflow` workflow created
- `my_workflow` workflow created
- All three appear in `poem.yaml` under `workflows` section

**Evidence**:

- Output of `cat poem/config/poem.yaml` showing all three workflow definitions

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 8: AC3 - Workflow Name Validation (Invalid Names)

**What to test**: Invalid workflow names are rejected with error message

**Steps**:

1. In test directory from Test 7
2. Run `poem-os add-workflow "invalid name"` (with space)
3. Observe error message
4. Run `poem-os add-workflow "test@123"` (with special char)
5. Observe error message
6. Run `poem-os add-workflow "test/path"` (with slash)
7. Observe error message

**Expected Result**:
‚úÖ All three commands fail with:

- Error message: "‚ùå Invalid workflow name. Use alphanumeric, dash, or underscore only."
- No workflows created
- No changes to `poem.yaml`

**Evidence**:

- Terminal screenshots showing error messages for all three invalid names

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

## ü§ñ Terminal Tests (Scriptable)

Tests using command-line tools - copy-paste ready commands.

### Test A: AC4 - Installation Flag --init

**What to test**: `npx poem-os install --init` creates workspace in one command

**Command**:

```bash
# Clean test directory
rm -rf /tmp/poem-test-3 && mkdir /tmp/poem-test-3 && cd /tmp/poem-test-3

# Run install with --init flag
npx poem-os install --init

# Verify workspace created
ls -la poem/
```

**Expected Output**:

```
poem/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ poem.yaml
‚îî‚îÄ‚îÄ shared/
    ‚îú‚îÄ‚îÄ prompts/
    ‚îî‚îÄ‚îÄ schemas/
```

**Validation**:

- ‚úÖ `.poem-core/` directory exists
- ‚úÖ `.poem-app/` directory exists
- ‚úÖ `poem/` directory exists (created by --init flag)
- ‚úÖ `poem/config/poem.yaml` file exists

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test B: AC4 - Installation Flag --workflow

**What to test**: `npx poem-os install --workflow youtube` creates workspace + workflow in one command

**Command**:

```bash
# Clean test directory
rm -rf /tmp/poem-test-4 && mkdir /tmp/poem-test-4 && cd /tmp/poem-test-4

# Run install with --workflow flag
npx poem-os install --workflow youtube

# Verify workspace and workflow created
ls -R poem/
cat poem/config/poem.yaml
```

**Expected Output**:

Directory structure includes:

```
poem/workflows/youtube/
‚îú‚îÄ‚îÄ prompts/
‚îú‚îÄ‚îÄ schemas/
‚îú‚îÄ‚îÄ mock-data/
‚îî‚îÄ‚îÄ workflow-state/
```

Config file shows:

```yaml
currentWorkflow: youtube
workflows:
  youtube:
    prompts: poem/workflows/youtube/prompts
    schemas: poem/workflows/youtube/schemas
    mockData: poem/workflows/youtube/mock-data
    workflowState: poem/workflows/youtube/workflow-state
```

**Validation**:

- ‚úÖ Workspace created (`poem/config/`, `poem/shared/`)
- ‚úÖ Workflow created (`poem/workflows/youtube/`)
- ‚úÖ All 4 workflow folders exist (prompts, schemas, mock-data, workflow-state)
- ‚úÖ `currentWorkflow` set to `youtube` in config

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test C: AC4 - Help Text Shows New Flags

**What to test**: `npx poem-os install --help` displays documentation for `--init` and `--workflow` flags

**Command**:

```bash
npx poem-os install --help
```

**Expected Output**:

Help text includes:

```
--init                    Create workspace folders after installation
--workflow <name>         Create workspace and add first workflow
```

**Validation**:

- ‚úÖ `--init` flag documented with description
- ‚úÖ `--workflow <name>` flag documented with description
- ‚úÖ Help text displays correctly

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test D: AC5 - Terminology Rename in Config File

**What to test**: `poem-core-config.yaml` uses `workflowState` instead of `workflowData`

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem
grep -n "workflowState" packages/poem-core/poem-core-config.yaml
grep -n "workflowData" packages/poem-core/poem-core-config.yaml
```

**Expected Output**:

```
# First command should show matches (workflowState exists)
38:      workflowState: dev-workspace/workflows/youtube-launch-optimizer/workflow-state
54:      workflowState: dev-workspace/workflows/nano-banana/workflow-state
77:    workflowState: dev-workspace/workflow-state

# Second command should show NO matches (workflowData removed)
37:      # Path to workflow-specific execution state directory (Story 1.10: renamed from workflowData)
76:  # Persisted workflow execution state (Story 1.10: renamed from workflowData)
```

**Validation**:

- ‚úÖ `workflowState` found on lines 38, 54, 77
- ‚úÖ `workflowData` only in comments explaining the rename (acceptable)

**Status**: ‚úÖ Passed

**Notes**: Comments reference old terminology to explain change - this is intentional documentation.

---

### Test E: AC5 - Terminology Rename in TypeScript Config Service

**What to test**: TypeScript interfaces use `workflowState` instead of `workflowData`

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem
grep -n "workflowState" packages/poem-app/src/services/config/poem-config.ts
grep -n "workflowData" packages/poem-app/src/services/config/poem-config.ts
```

**Expected Output**:

```
# First command shows workflowState exists
42:  workflowState: string;
55:  workflowState: string;   # FIXED during SAT
88:  workflowState: 'dev-workspace/workflow-state',
100:  workflowState: 'poem/workflow-state',
167:      workflowState: (workspaceConfig.workflowState as string) || defaults.workflowState,
263: * @param type - The workspace path type (prompts, schemas, mockData, config, workflowState)
326: * @param resourceType - The resource type (prompts, schemas, mockData, workflowState)
331:  resourceType: 'prompts' | 'schemas' | 'mockData' | 'workflowState',

# Second command shows only comment references
41:  /** Path to workflow-specific execution state directory (Story 1.10: renamed from workflowData) */
```

**Validation**:

- ‚úÖ `workflowState` found in multiple locations (including line 55)
- ‚úÖ `workflowData` only in comments explaining the rename (acceptable)

**Status**: ‚úÖ Passed (FIXED during SAT phase)

**Notes**: Bug was found on line 55 (`WorkspacePaths` interface had `workflowData` instead of `workflowState`). Fixed during SAT phase by changing line 55 to use correct terminology. All terminology renames now complete.

---

### Test F: AC7 - Preservation Rules Updated

**What to test**: `.poem-preserve` file protects `poem/config/`, `poem/shared/`, `poem/workflows/` (not just `poem/`)

**Command**:

```bash
cd /tmp/poem-test-4  # Test directory from Test B
cat .poem-preserve
```

**Expected Output**:

```
# User workspace - always preserved
poem/config/
poem/shared/
poem/workflows/

# Dev workspace - always preserved (if exists)
dev-workspace/
```

**Validation**:

- ‚úÖ `poem/config/` listed as preserved
- ‚úÖ `poem/shared/` listed as preserved
- ‚úÖ `poem/workflows/` listed as preserved
- ‚úÖ Old `poem/` NOT listed (changed to specific subdirectories)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test G: AC8 - README Updated with New Workflow

**What to test**: `README.md` documents new installation workflow (bare install ‚Üí init ‚Üí add-workflow)

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem
grep -A 10 "Installation Options" README.md
```

**Expected Output**:

README includes section documenting:

- Path 1: Bare install (`npx poem-os install`)
- Path 2: Install with workspace (`npx poem-os install --init`)
- Path 3: Install with workflow (`npx poem-os install --workflow <name>`)

**Validation**:

- ‚úÖ "Installation Options" section exists in README
- ‚úÖ Documents bare install path
- ‚úÖ Documents `--init` flag
- ‚úÖ Shows installation paths clearly

**Status**: ‚úÖ Passed

**Notes**: README properly updated with new workflow documentation.

---

### Test H: AC8 - Architecture Docs Updated

**What to test**: `docs/architecture/unified-project-structure.md` reflects two-tier architecture and `workflow-state` terminology

**Command**:

```bash
cd /Users/davidcruwys/dev/ad/poem-os/poem
grep -n "workflow-state" docs/architecture/unified-project-structure.md
grep -n "workflow-data" docs/architecture/unified-project-structure.md
```

**Expected Output**:

```
# First command shows workflow-state exists
226:‚îÇ           ‚îî‚îÄ‚îÄ workflow-state/       # Execution state (renamed from workflow-data)

# Second command shows only explanatory comment
226:‚îÇ           ‚îî‚îÄ‚îÄ workflow-state/       # Execution state (renamed from workflow-data)
```

**Validation**:

- ‚úÖ `workflow-state` found in architecture docs
- ‚úÖ `workflow-data` only in comment explaining the rename (acceptable)
- ‚úÖ Two-tier architecture documented

**Status**: ‚úÖ Passed

**Notes**: Architecture docs properly updated. Old terminology only appears in explanatory comment.

---

## ‚è≥ Not Testable Yet

**AC5 - Unit Tests for Terminology Rename**:
**Reason**: Dev Agent noted "Run tests to ensure no regressions" as pending
**When**: Can be tested after running `npm test` command

---

## Test Checklist

Copy this checklist to track overall progress:

**Human Tests:**

- [ ] Test 1: Bare installation creates no workspace
- [ ] Test 2: Init command creates root workspace
- [ ] Test 3: Init command is idempotent
- [ ] Test 4: Add workflow creates workflow folders
- [ ] Test 5: Add second workflow (currentWorkflow unchanged)
- [ ] Test 6: Add workflow is idempotent
- [ ] Test 7: Workflow name validation (valid names)
- [ ] Test 8: Workflow name validation (invalid names)

**Terminal Tests:**

- [ ] Test A: Installation flag --init (requires manual testing)
- [ ] Test B: Installation flag --workflow (requires manual testing)
- [ ] Test C: Help text shows new flags (requires manual testing)
- [x] Test D: Terminology rename in config file ‚úÖ
- [x] Test E: Terminology rename in TypeScript ‚úÖ (FIXED)
- [ ] Test F: Preservation rules updated (requires manual testing)
- [x] Test G: README updated ‚úÖ
- [x] Test H: Architecture docs updated ‚úÖ

**Overall Status**: üîÑ In Progress (Automated tests pass, manual tests pending)

---

## Troubleshooting

### Issue: "command not found: poem-os"

**Symptom**: Running `poem-os init` or `poem-os add-workflow` returns "command not found"
**Solution**:

1. Ensure you're in the correct directory after `npx poem-os install`
2. If testing locally (not via npx), run `npm link` in the POEM repo first
3. Alternative: Use full path to `bin/install.js` for testing

### Issue: "Cannot find module 'js-yaml'"

**Symptom**: Running `poem-os add-workflow` fails with module not found error
**Solution**: Run `npm install` in the POEM repo to install the new `js-yaml` dependency

### Issue: Workspace already exists from previous test

**Symptom**: Tests fail because `poem/` folder already exists
**Solution**: Clean test directory before each test: `rm -rf /tmp/poem-test-* && mkdir /tmp/poem-test-1`

### Issue: Config file malformed after multiple tests

**Symptom**: `poem.yaml` contains duplicate entries or syntax errors
**Solution**: Delete `poem/` folder and start fresh with `poem-os init`

### Issue: Preservation file doesn't match expected format

**Symptom**: `.poem-preserve` shows old `poem/` instead of specific subdirectories
**Solution**: This indicates the preservation template wasn't updated correctly. Check `bin/preservation.js` for correct template.

---

## Test Results Summary

**Date Tested**: 2026-01-26
**Tester**: Taylor (SAT Guide Creator) - Automated Tests Only

**Results**:

- Human Tests: **0** / **8** passed (pending manual execution)
- Terminal Tests: **4** / **8** passed (4 require manual execution)
- Automated Tests: **4** / **4** passed ‚úÖ
- Total: **4** / **16** passed (12 pending manual testing)

**Issues Found**:

1. **BUG - Test E (FIXED)**: Incomplete rename in `packages/poem-app/src/services/config/poem-config.ts` line 55 - `WorkspacePaths` interface had `workflowData: string;` instead of `workflowState: string;`. **Fixed during SAT phase.**

**Sign-off**: ‚úÖ Automated tests pass - Ready for manual testing

**Next Steps**:
1. ‚úÖ FIXED: TypeScript interface bug corrected (line 55: workflowData ‚Üí workflowState)
2. Run `npm test` to verify no regressions (recommended before manual testing)
3. Execute all manual tests (Human Tests 1-8, Terminal Tests A-C, F)
4. Update SAT file with manual test results
5. Proceed to Quinn (QA) for final review

---

_Generated by Taylor (SAT Guide Creator) from Story 1.10_
