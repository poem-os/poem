# Story 1.6 - Acceptance Test Guide

## Quick Summary

**Story**: NPM Package Publishing
**Status**: Review
**Test Focus**: Verifies POEM package is configured for NPM publishing with correct metadata, bin command, file filtering, and documentation

## Prerequisites

**Before testing, ensure:**

- [ ] Story status is "Review"
- [ ] You have Node.js 22.x or higher installed (`node --version`)
- [ ] Working directory is POEM repository root (`/Users/davidcruwys/dev/ad/poem-os/poem`)
- [ ] No npm link is currently active (run `npm unlink -g poem-os` if unsure)

**Environment Setup:**

- Node.js: 22.x or higher
- Working directory: `/Users/davidcruwys/dev/ad/poem-os/poem`

---

## ðŸ¤– Terminal Tests (Scriptable)

Tests using command-line tools - copy-paste ready commands.

### Test A: AC1 - Verify "private" field removed

**What to test**: package.json no longer has "private": true blocking publication

**Command**:

```bash
grep -i '"private"' package.json
```

**Expected Output**:

```
(no output - field should not exist)
```

**Validation**:

- âœ… Command returns no results (exit code 1 = not found)
- âœ… "private" field is absent from package.json

**Status**: âœ… Passed

**Notes**: Command returned no output - "private" field successfully removed

---

### Test B: AC2 - Verify "bin" field present

**What to test**: package.json includes "bin" field mapping poem-os command

**Command**:

```bash
grep -A 1 '"bin"' package.json
```

**Expected Output**:

```
  "bin": {
    "poem-os": "./bin/install.js"
```

**Validation**:

- âœ… "bin" field exists
- âœ… Maps "poem-os" to "./bin/install.js"

**Status**: âœ… Passed

**Notes**: All automated terminal tests passed successfully

---

### Test C: AC3 - Verify repository/bugs/homepage URLs

**What to test**: package.json includes GitHub URLs for discoverability

**Command**:

```bash
grep -A 2 '"repository"' package.json && echo "---" && grep -A 2 '"bugs"' package.json && echo "---" && grep '"homepage"' package.json
```

**Expected Output**:

```
  "repository": {
    "type": "git",
    "url": "https://github.com/appydave/poem-os.git"
---
  "bugs": {
    "url": "https://github.com/appydave/poem-os/issues"
---
  "homepage": "https://github.com/appydave/poem-os#readme",
```

**Validation**:

- âœ… "repository" field with git type and GitHub URL
- âœ… "bugs" field with GitHub issues URL
- âœ… "homepage" field with GitHub repo URL

**Status**: âœ… Passed

**Notes**: All automated terminal tests passed successfully

---

### Test D: AC4 - Verify "files" array present

**What to test**: package.json defines "files" array to control published content

**Command**:

```bash
grep -A 5 '"files"' package.json
```

**Expected Output**:

```
  "files": [
    "bin/",
    "packages/",
    "README.md",
    "LICENSE"
  ],
```

**Validation**:

- âœ… "files" array exists
- âœ… Includes "bin/" directory
- âœ… Includes "packages/" directory
- âœ… Includes "README.md"
- âœ… Includes "LICENSE"
- âœ… Excludes development files (docs/, data/, .github/)

**Status**: âœ… Passed

**Notes**: All automated terminal tests passed successfully

---

### Test E: AC5.1 - Verify bin/install.js shebang

**What to test**: Installer script has correct shebang for npx execution

**Command**:

```bash
head -1 bin/install.js
```

**Expected Output**:

```
#!/usr/bin/env node
```

**Validation**:

- âœ… First line is shebang
- âœ… Uses `/usr/bin/env node` for cross-platform compatibility

**Status**: âœ… Passed

**Notes**: All automated terminal tests passed successfully

---

### Test F: AC5.2 - Verify bin/install.js permissions

**What to test**: Installer script has executable permissions

**Command**:

```bash
ls -la bin/install.js | awk '{print $1, $9}'
```

**Expected Output**:

```
-rwxr-xr-x bin/install.js
```

**Validation**:

- âœ… File has execute permission (x) for owner
- âœ… File is readable by all

**Status**: âœ… Passed

**Notes**: All automated terminal tests passed successfully

---

### Test G: AC6 - Verify PUBLISHING.md exists

**What to test**: PUBLISHING.md documentation file created

**Command**:

```bash
ls -lh PUBLISHING.md && echo "---" && wc -l PUBLISHING.md
```

**Expected Output**:

```
-rw-r--r--  ... PUBLISHING.md
---
{line count > 200} PUBLISHING.md
```

**Validation**:

- âœ… PUBLISHING.md file exists in root directory
- âœ… File has substantial content (200+ lines)

**Status**: âœ… Passed

**Notes**: All automated terminal tests passed successfully

---

### Test H: AC7 - Verify GitHub Actions workflow exists

**What to test**: GitHub Actions workflow template created

**Command**:

```bash
ls -lh .github/workflows/publish.yaml && echo "---" && head -10 .github/workflows/publish.yaml
```

**Expected Output**:

```
-rw-r--r--  ... .github/workflows/publish.yaml
---
# GitHub Actions Workflow for NPM Publishing
#
# Status: Template (Not Active)
...
```

**Validation**:

- âœ… Workflow file exists at `.github/workflows/publish.yaml`
- âœ… File contains workflow configuration
- âœ… Marked as template/not active

**Status**: âœ… Passed

**Notes**: All automated terminal tests passed successfully

---

## ðŸ§‘ Human Tests (Visual/Manual)

Tests requiring human observation - documentation review, installation verification.

### Test 1: AC5 - Local Installation Test (Full)

**What to test**: npm link enables local testing of poem-os installation

**Prerequisites**:
- Ensure no existing npm link: `npm unlink -g poem-os 2>/dev/null`

**Steps**:

1. Run `npm link` in POEM repository root
2. Create clean test directory: `mkdir -p /tmp/sat-test-poem-full && cd /tmp/sat-test-poem-full`
3. Run `npx poem-os install`
4. Observe installer output in terminal
5. Verify directories created: `ls -la`
6. Check directory contents: `ls .poem-core .poem-app poem .claude`

**Expected Result**:

âœ… Installer completes successfully:
- Terminal shows "âœ… POEM installed successfully!"
- Four directories created: `.poem-core/`, `.poem-app/`, `poem/`, `.claude/`
- `.poem-core/` contains agents, workflows, skills subdirectories
- `.poem-app/` contains src/, tests/, package.json
- `poem/` contains prompts/, schemas/, config/ subdirectories
- `.claude/` contains commands/poem/ structure

**Evidence**:
- Terminal output shows successful installation message
- All four directories present
- Directory tree structure matches expected layout

**Cleanup**:
```bash
cd ~
rm -rf /tmp/sat-test-poem-full
```

**Status**: â¬œ Not Tested

**Notes**: Requires manual execution by human tester

---

### Test 2: AC5 - Local Installation Test (--core flag)

**What to test**: --core flag installs only framework

**Steps**:

1. Create test directory: `mkdir -p /tmp/sat-test-poem-core && cd /tmp/sat-test-poem-core`
2. Run `npx poem-os install --core`
3. Verify directories: `ls -la`

**Expected Result**:

âœ… Only framework installed:
- `.poem-core/` directory created
- `.claude/` directory created
- `.poem-app/` NOT created
- `poem/` NOT created

**Cleanup**:
```bash
cd ~
rm -rf /tmp/sat-test-poem-core
```

**Status**: â¬œ Not Tested

**Notes**: Requires manual execution by human tester

---

### Test 3: AC5 - Local Installation Test (--app flag)

**What to test**: --app flag installs only runtime

**Steps**:

1. Create test directory: `mkdir -p /tmp/sat-test-poem-app && cd /tmp/sat-test-poem-app`
2. Run `npx poem-os install --app`
3. Verify directories: `ls -la`

**Expected Result**:

âœ… Only runtime installed:
- `.poem-app/` directory created
- `.poem-core/` NOT created
- `.claude/` NOT created
- `poem/` NOT created

**Cleanup**:
```bash
cd ~
rm -rf /tmp/sat-test-poem-app
npm unlink -g poem-os
```

**Status**: â¬œ Not Tested

**Notes**: Requires manual execution by human tester

---

### Test 4: AC6 - Review PUBLISHING.md Content

**What to test**: PUBLISHING.md provides comprehensive manual publishing guide

**Steps**:

1. Open `PUBLISHING.md` in text editor or viewer
2. Review document structure and content
3. Verify sections present:
   - Prerequisites
   - Version Strategy
   - Pre-Publish Checklist
   - Publishing to NPM
   - Post-Publish Verification
   - Rollback Instructions
   - Troubleshooting

**Expected Result**:

âœ… Documentation is comprehensive and clear:
- All major sections present
- Step-by-step instructions provided
- Commands are copy-paste ready
- Version strategy explained (semantic versioning)
- Pre-publish checklist includes tests, linting, build
- Rollback/deprecation instructions included
- Troubleshooting section helpful

**Evidence**:
- Document has logical flow from setup â†’ publish â†’ verify â†’ rollback
- Technical commands are accurate
- Non-technical explanations clear

**Status**: â¬œ Not Tested

**Notes**: Requires manual documentation review by human tester

---

### Test 5: AC7 - Review GitHub Actions Workflow

**What to test**: Workflow template is well-structured for future use

**Steps**:

1. Open `.github/workflows/publish.yaml` in text editor
2. Review workflow configuration
3. Verify key elements:
   - Triggers (workflow_dispatch, commented push tags)
   - Node.js 22.x setup
   - Steps: Install â†’ Lint â†’ Test â†’ Build â†’ Publish
   - NPM_TOKEN usage
   - GitHub release creation

**Expected Result**:

âœ… Workflow is complete template:
- Marked as "Template (Not Active)" in comments
- Manual trigger (workflow_dispatch) enabled
- Tag-based trigger commented out for future
- All necessary steps present
- Clear documentation in comments
- Setup instructions provided

**Evidence**:
- Workflow file valid YAML
- Steps are logical and complete
- Documentation explains activation process

**Status**: â¬œ Not Tested

**Notes**: Requires manual workflow review by human tester

---

## Test Checklist

Copy this checklist to track overall progress:

**Terminal Tests:**

- [x] Test A: Verify "private" field removed âœ…
- [x] Test B: Verify "bin" field present âœ…
- [x] Test C: Verify repository/bugs/homepage URLs âœ…
- [x] Test D: Verify "files" array present âœ…
- [x] Test E: Verify bin/install.js shebang âœ…
- [x] Test F: Verify bin/install.js permissions âœ…
- [x] Test G: Verify PUBLISHING.md exists âœ…
- [x] Test H: Verify GitHub Actions workflow exists âœ…

**Human Tests:**

- [ ] Test 1: Local installation (full)
- [ ] Test 2: Local installation (--core)
- [ ] Test 3: Local installation (--app)
- [ ] Test 4: Review PUBLISHING.md content
- [ ] Test 5: Review GitHub Actions workflow

**Overall Status**: ðŸ”„ In Progress (8/13 automated tests passed, 5 human tests pending)

---

## Troubleshooting

### Issue: npm link fails with permission error

**Symptom**: `EACCES: permission denied` when running npm link
**Solution**: May need sudo on some systems: `sudo npm link` (or use nvm for better permissions management)

### Issue: npx poem-os not found after npm link

**Symptom**: Command not found after running npm link
**Solution**:
1. Verify link created: `npm list -g --depth=0 | grep poem-os`
2. If missing, run `npm link` again
3. Check PATH includes npm global bin directory

### Issue: "private" field still showing in grep

**Symptom**: Test A finds "private" field
**Solution**: Ensure package.json was saved after modification. Check git status to confirm file changed.

### Issue: Installation creates wrong directories

**Symptom**: Expected directories not created during Test 1-3
**Solution**:
1. Verify npm link is active: `which poem-os`
2. Ensure you're in clean test directory (no existing POEM installation)
3. Check installer script hasn't been modified

### Issue: PUBLISHING.md or workflow file missing

**Symptom**: Tests G or H fail - files not found
**Solution**: Verify you're in correct directory (POEM repo root). Run `git status` to confirm files were created and committed.

---

## Test Results Summary

**Date Tested**: 2026-01-13 (Automated tests completed)
**Tester**: Taylor (SAT Guide Creator) - Automated tests only

**Results**:

- Terminal Tests: **8 / 8** passed âœ…
- Human Tests: **0 / 5** passed (Pending manual execution)
- Total: **8 / 13** passed

**Issues Found**:

None in automated tests. Human tests require manual execution.

**Automated Test Status**: âœ… All terminal tests passed
**Human Test Status**: â¬œ Pending manual execution

**Next Steps**:
1. Human tester should execute Tests 1-5 manually
2. Update this SAT file with human test results
3. Final sign-off after all tests complete

**Sign-off**: â¬œ Pending human test completion

---

_Generated by Taylor (SAT Guide Creator) from Story 1.6_
