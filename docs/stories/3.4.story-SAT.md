# Story 3.4 - Acceptance Test Guide

## Quick Summary

**Story**: Implement Test Prompt Workflow
**Status**: Review
**Test Focus**: Validate that test-prompt.yaml workflow definition is correctly structured and ready for Prompt Engineer agent execution

## Prerequisites

**Before testing, ensure:**

- [ ] Story status is "Review"
- [ ] Working directory: `/Users/davidcruwys/dev/ad/poem-os/poem`
- [ ] Dependencies installed (`npm install`)
- [ ] Unit tests have passed (282/282 tests)

**Environment Setup:**

- Node.js: 22.x LTS
- Working directory: `~/dev/ad/poem-os/poem`
- Test framework: Vitest 4.x

---

## ü§ñ Terminal Tests (Scriptable)

Tests using command-line tools - copy-paste ready commands.

### Test A: AC1 - Workflow file exists and is valid YAML

**What to test**: Workflow file exists at correct location and parses as valid YAML

**Command**:

```bash
ls -lh packages/poem-core/workflows/test-prompt.yaml
```

**Expected Output**:

```
-rw-r--r--  1 user  staff   523B  Jan 11 20:41 packages/poem-core/workflows/test-prompt.yaml
```

**Validation**:

- ‚úÖ File exists at `packages/poem-core/workflows/test-prompt.yaml`
- ‚úÖ File size is approximately 523 bytes (520-530 bytes acceptable)
- ‚úÖ File has read permissions

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test B: AC1 - Workflow structure validation via unit tests

**What to test**: All 41 unit tests pass, validating workflow YAML structure

**Command**:

```bash
cd packages/poem-app && npm test -- tests/workflows/test-prompt.test.ts
```

**Expected Output**:

```
‚úì tests/workflows/test-prompt.test.ts (41 tests) 8ms

Test Files  1 passed (1)
     Tests  41 passed (41)
```

**Validation**:

- ‚úÖ All 41 tests pass
- ‚úÖ No test failures or errors
- ‚úÖ Workflow YAML parses correctly
- ‚úÖ All required fields present (id, name, version, pathResolution, etc.)
- ‚úÖ All 11 steps have unique IDs
- ‚úÖ All 7 acceptance criteria covered by steps

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test C: AC1 - Workflow metadata validation

**What to test**: Workflow has correct id, version, and pathResolution

**Command**:

```bash
grep -A 5 "^id:" packages/poem-core/workflows/test-prompt.yaml | head -n 6
```

**Expected Output**:

```
id: test-prompt
name: Test Prompt with Data
version: "1.0.0"
author: POEM Framework
lastUpdated: "2026-01-11"
```

**Validation**:

- ‚úÖ Workflow id is "test-prompt"
- ‚úÖ Version is "1.0.0"
- ‚úÖ Author is "POEM Framework"
- ‚úÖ lastUpdated is "2026-01-11"

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test D: AC1 - Path resolution configuration

**What to test**: Workflow uses pathResolution: config (no hardcoded paths)

**Command**:

```bash
grep "pathResolution:" packages/poem-core/workflows/test-prompt.yaml
```

**Expected Output**:

```
pathResolution: config
```

**Validation**:

- ‚úÖ pathResolution is set to "config"
- ‚úÖ Workflow inherits paths from poem-core-config.yaml

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test E: AC1 - Workflow has 11 steps

**What to test**: Workflow contains exactly 11 sequential steps

**Command**:

```bash
grep -c "^  - id:" packages/poem-core/workflows/test-prompt.yaml
```

**Expected Output**:

```
11
```

**Validation**:

- ‚úÖ Workflow has exactly 11 steps
- ‚úÖ Step count matches specification

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test F: AC1 - Workflow step IDs are correct

**What to test**: All 11 step IDs match specification

**Command**:

```bash
grep "^  - id:" packages/poem-core/workflows/test-prompt.yaml | awk '{print $3}'
```

**Expected Output**:

```
select-prompt
choose-data-source
load-test-data
load-schema
render-template
validate-output
collect-results
run-another-scenario
test-summary
save-results
complete
```

**Validation**:

- ‚úÖ All 11 step IDs present
- ‚úÖ Step IDs match workflow specification
- ‚úÖ Step IDs are unique

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

## ‚è≥ Not Testable Yet

### AC2: Workflow accepts prompt path and data source

**Reason**: Requires Prompt Engineer agent (Penny) runtime execution via `/poem/agents/penny` then `*test` command
**When**: Manual testing can be performed by activating Prompt Engineer agent in Claude Code
**Notes**: Workflow definition is complete; execution testing deferred to agent runtime per Story 3.3 pattern

---

### AC3: Calls render API endpoint and validates against schema

**Reason**: Requires Prompt Engineer agent runtime execution with live API server
**When**: Manual testing can be performed by activating Prompt Engineer agent and running workflow
**Notes**: Workflow instructions reference POST /api/prompt/render and POST /api/schema/validate endpoints correctly

---

### AC4: Reports missing fields, helper errors, warnings

**Reason**: Requires Prompt Engineer agent runtime execution with actual prompt rendering
**When**: Manual testing can be performed during agent workflow execution
**Notes**: Workflow step 5 (render-template) and step 6 (validate-output) handle error reporting

---

### AC5: Can run multiple test scenarios in sequence

**Reason**: Requires Prompt Engineer agent runtime execution
**When**: Manual testing can be performed by running workflow and choosing "yes" at run-another-scenario step
**Notes**: Workflow step 8 (run-another-scenario) implements loop-back pattern

---

### AC6: Displays render time and output length

**Reason**: Requires Prompt Engineer agent runtime execution
**When**: Manual testing can be performed during workflow execution
**Notes**: Workflow step 5 (render-template) captures and displays renderTimeMs and output length metrics

---

### AC7: Output can be saved to file for review

**Reason**: Requires Prompt Engineer agent runtime execution
**When**: Manual testing can be performed during workflow execution
**Notes**: Workflow step 10 (save-results) implements file save with user confirmation

---

## Test Checklist

Copy this checklist to track overall progress:

**Terminal Tests:**

- [ ] Test A: Workflow file exists and is valid YAML
- [ ] Test B: Workflow structure validation via unit tests (41 tests)
- [ ] Test C: Workflow metadata validation (id, version, author)
- [ ] Test D: Path resolution configuration (pathResolution: config)
- [ ] Test E: Workflow has 11 steps
- [ ] Test F: Workflow step IDs are correct

**Not Testable Yet:**

- [ ] AC2: Workflow accepts prompt path and data source (requires agent runtime)
- [ ] AC3: Calls render API and validates (requires agent runtime)
- [ ] AC4: Reports errors/warnings (requires agent runtime)
- [ ] AC5: Multiple test scenarios (requires agent runtime)
- [ ] AC6: Displays metrics (requires agent runtime)
- [ ] AC7: Saves output to file (requires agent runtime)

**Overall Status**: ‚¨ú Not Started | üîÑ In Progress | ‚úÖ All Passed | ‚ùå Issues Found

---

## Troubleshooting

### Issue: Unit tests fail

**Symptom**: `npm test` shows failures in test-prompt.test.ts
**Solution**:
1. Ensure you're in the correct directory: `cd packages/poem-app`
2. Re-run tests: `npm test -- tests/workflows/test-prompt.test.ts`
3. Check that workflow file exists: `ls ../../packages/poem-core/workflows/test-prompt.yaml`

### Issue: File not found

**Symptom**: `ls` command shows "No such file or directory"
**Solution**:
1. Verify you're in project root: `pwd` should show `.../poem-os/poem`
2. Check file was created: `find . -name "test-prompt.yaml"`
3. If missing, workflow file was not created during Story 3.4 implementation

### Issue: Grep command returns nothing

**Symptom**: grep commands show no output
**Solution**:
1. Verify file exists first: `ls -l packages/poem-core/workflows/test-prompt.yaml`
2. Check file is not empty: `wc -l packages/poem-core/workflows/test-prompt.yaml` (should show ~523 lines)
3. Try cat command: `cat packages/poem-core/workflows/test-prompt.yaml | head -n 20`

---

## Manual Workflow Testing (Optional)

**Note**: While workflow definition testing (AC1) can be completed now, full workflow execution testing (AC2-7) requires the Prompt Engineer agent. This is by design per BMAD workflow pattern.

**To test workflow execution manually:**

1. Activate Prompt Engineer agent in Claude Code:
   ```
   /poem/agents/penny
   ```

2. Execute test workflow:
   ```
   *test
   ```

3. Follow workflow prompts through all 11 steps

4. Verify:
   - Prompt selection works (step 1)
   - Data source options presented (step 2)
   - Data loads correctly (step 3)
   - Schema loads if present (step 4)
   - Template renders with metrics (step 5)
   - Validation works if schema present (step 6)
   - Results collected (step 7)
   - Multiple scenarios option works (step 8)
   - Summary displays correctly (step 9)
   - File save works (step 10)
   - Completion message shown (step 11)

**Evidence**: Document workflow execution in story comments or QA notes

---

## Test Results Summary

**Date Tested**: _________________
**Tester**: _________________

**Results**:

- Terminal Tests: __ / 6 passed
- Not Testable Yet: 6 items (requires agent runtime)
- Total: __ / 6 passed (workflow definition tests)

**Issues Found**:

1. _________________
2. _________________

**Sign-off**: ‚úÖ Workflow definition accepted | ‚ùå Issues require fixes

---

**Notes on Testing Approach**:

This story implements a **workflow definition** (YAML file), not a runtime feature. The acceptance criteria split into two categories:

1. **AC1** - Workflow structure (testable now via file checks and unit tests)
2. **AC2-7** - Workflow execution behavior (requires Prompt Engineer agent runtime)

This is consistent with POEM's architecture where:
- Workflows are YAML definitions interpreted by agents
- Unit tests validate structure and metadata
- Execution testing happens when agent uses the workflow
- Pattern established in Story 3.2 (new-prompt) and Story 3.3 (refine-prompt)

---

_Generated by Taylor (SAT Guide Creator) from Story 3.4_
