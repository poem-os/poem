# Story 2.2 - Acceptance Test Guide

## Quick Summary

**Story**: Implement Handlebars Service
**Status**: Review
**Test Focus**: Handlebars service for template compilation and rendering with helper support

## Prerequisites

**Before testing, ensure:**

- [ ] Story status is "Review" or "Complete"
- [ ] Server is NOT running (for clean startup tests)
- [ ] Dependencies installed (`npm install` in project root)
- [ ] Unit tests pass (`npm test`)

**Environment Setup:**

- Node.js: 22.x LTS
- Port: 4321 (default Astro port)
- Working directory: `/Users/davidcruwys/dev/ad/poem-os/poem`

---

## ğŸ§‘ Human Tests (Visual/Manual)

Tests requiring human observation - terminal logs, server startup behavior.

### Test 1: AC1 - Server initializes Handlebars service on startup

**What to test**: Handlebars service initializes when the Astro server starts

**Steps**:

1. Open terminal and navigate to project root:
   ```bash
   cd /Users/davidcruwys/dev/ad/poem-os/poem
   ```
2. Start the development server:
   ```bash
   npm run dev --workspace=@poem-os/app
   ```
3. Observe terminal output during startup

**Expected Result**:
âœ… Server starts successfully with Handlebars service initialized:

- Server shows startup message with port number
- No errors related to Handlebars initialization
- `helpersLoaded` count is tracked (may be 0 if no helpers exist yet)

**Evidence**:

- Terminal screenshot showing clean startup
- No error messages related to handlebars

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test 2: AC2/AC3 - Helpers directory scanned and logged on startup

**What to test**: Service scans helpers directory and logs results during initialization

**Steps**:

1. Ensure server is stopped (Ctrl+C if running)
2. Verify helpers directory exists:
   ```bash
   ls -la packages/poem-app/src/services/handlebars/helpers/
   ```
3. Start server:
   ```bash
   npm run dev --workspace=@poem-os/app
   ```
4. Observe terminal output for helper loading messages

**Expected Result**:
âœ… Terminal shows helper loading status:

- If helpers exist: Shows green "âœ… Loaded X helper(s): ..." message
- If no helpers: Shows yellow "âš ï¸ Helpers directory not found" or empty directory (no helpers to load)
- No crashes or errors during helper loading

**Evidence**:

- Terminal screenshot showing helper loading message (or absence of errors)

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

## ğŸ¤– Terminal Tests (Scriptable)

Tests using command-line tools - copy-paste ready commands.

### Test A: Unit Tests Pass (AC4, AC5, AC6, AC7)

**What to test**: All unit tests for HandlebarsService pass, validating compile/render methods, error handling, graceful degradation, and performance

**Command** (run from project root):

```bash
npm test
```

**Expected Output**:

```
âœ“ tests/services/handlebars/service.test.ts (31 tests)
âœ“ tests/api/health.test.ts (7 tests)

Test Files  2 passed
Tests  38 passed
```

**Validation**:

- âœ… All 31 handlebars service tests pass
- âœ… All 7 health endpoint tests pass
- âœ… Total: 38 tests passing
- âœ… No test failures

**Status**: âœ… Passed

**Notes**: 38 tests passed (31 handlebars + 7 health)

---

### Test B: Health Endpoint Returns helpersLoaded (AC1)

**What to test**: Health endpoint includes helpersLoaded count from Handlebars service

**Prerequisites**: Server must be running (`npm run dev --workspace=@poem-os/app`)

**Command**:

```bash
curl -s http://localhost:4321/api/health | jq .
```

**Expected Output**:

```json
{
  "status": "ok",
  "version": "0.1.0",
  "uptime": <number>,
  "helpersLoaded": 0
}
```

**Validation**:

- âœ… Response contains `helpersLoaded` field
- âœ… `helpersLoaded` is a number (0 if no helpers registered)
- âœ… Status is "ok"
- âœ… Response is valid JSON

**Status**: â¬œ Not Tested | âœ… Passed | âŒ Failed

**Notes**: _________________

---

### Test C: TypeScript Compilation (All files valid)

**What to test**: All TypeScript files compile without errors

**Command** (run from project root):

```bash
npx tsc --noEmit
```

**Expected Output**:

```
(no output - success)
```

**Validation**:

- âœ… No TypeScript errors
- âœ… Command exits with code 0

**Status**: âœ… Passed

**Notes**: Exit code 0, no TypeScript errors

---

### Test D: ESLint Passes (Code Quality)

**What to test**: No ESLint errors in the codebase

**Command** (run from project root):

```bash
npm run lint
```

**Expected Output**:

```
/Users/.../health.ts
  16:27  warning  '_context' is defined but never used  @typescript-eslint/no-unused-vars

âœ– 1 problem (0 errors, 1 warning)
```

**Validation**:

- âœ… 0 errors
- âœ… Only expected warning (_context unused param)

**Status**: âœ… Passed

**Notes**: 0 errors, 1 expected warning

---

### Test E: Handlebars Service Files Exist

**What to test**: All required files were created by the implementation

**Command**:

```bash
ls -la packages/poem-app/src/services/handlebars/
```

**Expected Output**:

```
index.ts
loader.ts
helpers/
```

**Validation**:

- âœ… `index.ts` exists (main service)
- âœ… `loader.ts` exists (helper loader)
- âœ… `helpers/` directory exists

**Status**: âœ… Passed

**Notes**: All 3 expected items present (index.ts, loader.ts, helpers/)

---

## â³ Not Testable Yet

**None** - All acceptance criteria are testable with current implementation.

---

## Test Checklist

Copy this checklist to track overall progress:

**Human Tests:**

- [ ] Test 1: Server initializes Handlebars service on startup
- [ ] Test 2: Helpers directory scanned and logged on startup

**Terminal Tests:**

- [x] Test A: Unit tests pass (31 handlebars + 7 health)
- [ ] Test B: Health endpoint returns helpersLoaded (requires running server)
- [x] Test C: TypeScript compilation passes
- [x] Test D: ESLint passes (0 errors)
- [x] Test E: Handlebars service files exist

**Overall Status**: ğŸ”„ In Progress (Human tests + Test B pending)

---

## Troubleshooting

### Issue: Server won't start

**Symptom**: Port 4321 already in use
**Solution**: Kill existing process: `lsof -ti :4321 | xargs kill -9` or use different port: `PORT=4322 npm run dev`

### Issue: Tests fail with module errors

**Symptom**: Cannot find module errors
**Solution**: Run `npm install` in project root

### Issue: jq not installed (for Test B)

**Symptom**: `jq: command not found`
**Solution**: Install jq: `brew install jq` (macOS) or use `curl -s http://localhost:4321/api/health` without piping to jq

### Issue: TypeScript errors

**Symptom**: `npx tsc --noEmit` shows errors
**Solution**: Check that all imports are correct and types are exported

---

## Test Results Summary

**Date Tested**: _________________
**Tester**: _________________

**Results**:

- Human Tests: __ / 2 passed
- Terminal Tests: __ / 5 passed
- Total: __ / 7 passed

**Issues Found**:

1. _________________
2. _________________

**Sign-off**: âœ… Story accepted | âŒ Issues require fixes

---

_Generated by Taylor (SAT Guide Creator) from Story 2.2_
