# Story 0.2 - Acceptance Test Guide

## Quick Summary

**Story**: Triage and Issue Logger Normalization
**Status**: Review
**Test Focus**: Verify unified vocabulary, v2.0 schema integration, and agent behaviors for Issue Logger and Triage systems

## Prerequisites

**Before testing, ensure:**

- [ ] Story status is "Review"
- [ ] Working directory: `/Users/davidcruwys/dev/ad/poem-os/poem`
- [ ] Fresh Claude Code session (no agents loaded)
- [ ] Access to existing `docs/planning/gap-analysis/usage-issues.jsonl` file (10 issues)

**Environment Setup:**

- IDE: Claude Code CLI
- Testing Method: Terminal commands + Agent activation
- Files: Documentation and agent files (no runtime code)

---

## ü§ñ Terminal Tests (Scriptable)

Tests using command-line tools - copy-paste ready commands.

### Test A: AC1 - Unified vocabulary file exists

**What to test**: `.bmad-core/vocabularies/work-item-taxonomy.yaml` contains unified severity/impact scale, work types, epic themes, and time estimates

**Command**:

```bash
cat .bmad-core/vocabularies/work-item-taxonomy.yaml
```

**Expected Output**:

YAML file containing:
- `severity:` section with critical/high/medium/low entries
- `workType:` section with bug/enhancement/refactor/docs/feature entries
- `epicThemes:` section with 8+ themes (installation, prompts, schemas, workflows, youtube, providers, visualization, deployment, maintenance)
- `timeEstimate:` section with quick/short/medium/long entries

**Validation**:

- ‚úÖ File exists and displays YAML content
- ‚úÖ Contains severity scale with `triageImpact` and `priority` mappings
- ‚úÖ Contains 8 epic themes mapping to Epic 0-7
- ‚úÖ Contains time estimates with ceremony levels

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test B: AC2 - Triage logic reference document exists

**What to test**: `.bmad-core/utils/triage-logic.md` documents 4 sequential decision criteria

**Command**:

```bash
cat .bmad-core/utils/triage-logic.md | head -100
```

**Expected Output**:

Markdown file containing:
- "## 4 Sequential Decision Criteria"
- Criterion 1: Time & Ceremony
- Criterion 2: Existing Story
- Criterion 3: Epic Fit
- Criterion 4: Epic 0 vs Ambiguous

**Validation**:

- ‚úÖ File exists at `.bmad-core/utils/triage-logic.md`
- ‚úÖ Contains 4 criteria sections
- ‚úÖ Contains "Estimate Inference Heuristics" section
- ‚úÖ Contains "Staleness Rules" section

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test C: AC3 - Existing v1.0 issues unchanged

**What to test**: Existing usage issues file still accessible with v1.0 format

**Command**:

```bash
cat docs/planning/gap-analysis/usage-issues.jsonl | head -3
```

**Expected Output**:

First 3 lines of JSONL showing v1.0 format (no `schemaVersion` field):

```json
{"timestamp":"2026-01-15T...","session":"...","category":"...","severity":"...","observation":"..."}
```

**Validation**:

- ‚úÖ File readable
- ‚úÖ First few lines show v1.0 format (no `schemaVersion` field)
- ‚úÖ Contains expected fields: timestamp, session, category, severity, observation

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test D: AC4-7 - Documentation contains v2.0 references

**What to test**: Issue Logger agent, Triage task, and README mention v2.0 schema

**Command**:

```bash
grep -c "schemaVersion" docs/planning/gap-analysis/observation-collector.md
grep -c "v2.0" .bmad-core/tasks/triage-work.md
grep "Schema Versioning" docs/planning/gap-analysis/README.md
```

**Expected Output**:

```
2
5
## Schema Versioning
```

**Validation**:

- ‚úÖ `observation-collector.md` contains "schemaVersion" (count > 0)
- ‚úÖ `triage-work.md` contains "v2.0" (count > 0)
- ‚úÖ `README.md` has "Schema Versioning" section

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test E: AC5 - Issue Logger has inference logic section

**What to test**: `observation-collector.md` documents v2.0 inference logic

**Command**:

```bash
grep -A 5 "Inference Logic" docs/planning/gap-analysis/observation-collector.md | head -20
```

**Expected Output**:

```
## Inference Logic (v2.0 Smart Defaults)

Load inference rules from `.bmad-core/utils/triage-logic.md`...

### estimatedTime Inference
```

**Validation**:

- ‚úÖ "Inference Logic (v2.0 Smart Defaults)" section exists
- ‚úÖ Contains subsections for estimatedTime, thematicArea, type
- ‚úÖ Contains "suggestedPath Computation" section

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test F: AC6 - Triage task has v2.0 detection logic

**What to test**: `triage-work.md` has v2.0 field reading and v1.0 fallback

**Command**:

```bash
grep -A 10 "v2.0 Usage Issues" .bmad-core/tasks/triage-work.md | head -15
```

**Expected Output**:

```
**For v2.0 Usage Issues** (Mode B with `schemaVersion: "2.0"`):
- **Read directly from JSONL**:
  - `estimatedTime` ‚Üí Estimate
  - `thematicArea` ‚Üí Area
  - `type` ‚Üí Type
```

**Validation**:

- ‚úÖ Step 2 has "For v2.0 Usage Issues" section
- ‚úÖ Documents reading estimatedTime, thematicArea, type from JSONL
- ‚úÖ Has "For v1.0 Usage Issues" fallback section
- ‚úÖ Documents staleness check

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test G: AC10 - Triage guide has Layer 3 section

**What to test**: `triage-guide.md` documents v2.0 integration

**Command**:

```bash
grep -A 10 "Layer 3: Behavioral Integration" docs/workflows/triage-guide.md | head -15
```

**Expected Output**:

```
## Layer 3: Behavioral Integration (v2.0)

Starting with **Story 0.2**, the Issue Logger and Triage systems...

### What is Layer 3?
```

**Validation**:

- ‚úÖ "Layer 3: Behavioral Integration (v2.0)" section exists
- ‚úÖ Contains subsection "v2.0 Issue Schema"
- ‚úÖ Contains subsection "Fast-Path Triage for v2.0 Issues"
- ‚úÖ Contains subsection "Staleness Detection Rules"

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

## üßë Human Tests (Visual/Manual)

Tests requiring human observation - agent activation and behavior validation.

### Test 1: AC8 - Issue Logger displays v2.0 inference prompts

**What to test**: Issue Logger agent computes and displays v2.0 fields with user confirmation

**Steps**:

1. In Claude Code, activate Issue Logger: `/poem/log-issues`
2. Report a test issue: "Template rendering fails for null values"
3. Observe agent response
4. Look for "Inferred v2.0 fields:" prompt
5. Check if agent displays: estimatedTime, thematicArea, type, suggestedPath, suggestedPathRationale
6. Verify agent prompts: "Does that look right? (yes/no/auto)"

**Expected Result**:
‚úÖ Issue Logger displays all v2.0 inference:

- Shows "Inferred v2.0 fields:" header
- Displays estimatedTime (e.g., "1-4hr from severity: high")
- Displays thematicArea (e.g., "prompts from keyword: template")
- Displays type (e.g., "bug from category: bug")
- Displays suggestedPath (e.g., "Epic 0 Story")
- Displays suggestedPathRationale with 2-3 bullet points
- Prompts for confirmation: "(yes/no/auto)"

**Evidence**:

- Agent response contains all 6 v2.0 fields
- Rationale explains routing decision
- Confirmation prompt displayed

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 2: AC8 - User can override inferred values

**What to test**: Issue Logger accepts user corrections

**Steps**:

1. Still in `/poem/log-issues` session from Test 1
2. When prompted "Does that look right?", type: `no`
3. Observe if agent asks for corrections
4. Provide a different value (e.g., change estimate from "1-4hr" to "<1hr")
5. Verify agent uses your value

**Expected Result**:
‚úÖ User override works:

- Agent responds to "no" by asking which field to correct
- Agent accepts user-provided value
- Agent uses corrected value instead of inferred value
- Agent acknowledges override in final message

**Evidence**:

- Agent prompts for corrections
- User value replaces inference

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 3: AC8 - "auto" mode skips future prompts

**What to test**: Issue Logger supports bulk logging with auto mode

**Steps**:

1. Still in `/poem/log-issues` session
2. Report another test issue: "Schema validation missing for prompts"
3. When prompted "Does that look right?", type: `auto`
4. Observe agent response
5. Report a third issue: "Helper hot-reload not working"
6. Verify no confirmation prompt this time

**Expected Result**:
‚úÖ Auto mode behavior:

- Typing "auto" is acknowledged by agent
- Agent confirms: "Auto mode enabled for remaining issues"
- Next issue skips confirmation prompt
- Agent uses inferred values automatically
- Agent still displays what was inferred in acknowledgment

**Evidence**:

- Auto mode confirmation message
- No prompt on subsequent issues
- Inferred values still shown in acknowledgment

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 4: AC9 - Triage displays v2.0 fast-path for new issues

**What to test**: Triage uses pre-computed suggestions for v2.0 issues

**Steps**:

1. Exit Issue Logger agent (type `exit` or start new Claude session)
2. Note which issue number you just logged with v2.0 format (e.g., issue-11)
3. Activate Triage: `/triage issue-11`
4. Observe output format
5. Look for "‚úì Suggestion still valid" message
6. Look for "Reason (from Issue Logger):" section

**Expected Result**:
‚úÖ v2.0 fast-path displayed:

- Shows "üîç Work Intake Triage (v2.0 Fast-Path)" header
- Displays "‚úì Suggestion still valid (logged {date})" in context analysis
- Shows pre-computed values: Area, Estimate, Type from issue
- Shows "Reason (from Issue Logger):" with rationale bullets
- Uses suggestedPath as primary recommendation

**Evidence**:

- Verification status shown
- Pre-computed rationale displayed
- No fresh computation (uses stored suggestion)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 5: AC11 - Triage infers fields for v1.0 issues

**What to test**: Triage works with existing v1.0 issues using inference

**Steps**:

1. In Claude Code, activate Triage: `/triage issue-1`
2. Observe output format
3. Note absence of "v2.0 Fast-Path" header
4. Note absence of "Reason (from Issue Logger)"
5. Verify routing recommendation still provided

**Expected Result**:
‚úÖ v1.0 backward compatibility:

- Shows standard "üîç Work Intake Triage" header (no "v2.0 Fast-Path")
- NO "‚úì Suggestion still valid" message
- Infers estimatedTime from severity
- Infers thematicArea from tags/keywords
- Infers type from category
- Computes routing using criteria 1-4
- Shows "Reason:" (not "Reason (from Issue Logger):")

**Evidence**:

- v1.0 issue processed successfully
- Fields inferred on-the-fly
- Routing recommendation provided
- No reference to pre-computed suggestions

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 6: AC9 - Staleness detection triggers recomputation

**What to test**: Triage recomputes routing for stale issues (>30 days old)

**Steps**:

1. Open file: `docs/planning/gap-analysis/usage-issues.jsonl`
2. Find the v2.0 issue you logged in Test 1 (has `schemaVersion: "2.0"`)
3. Edit the timestamp to 60 days ago (e.g., change 2026-01-21 to 2025-11-21)
4. Save file
5. Run: `/triage issue-{N}` for that issue
6. Observe output for staleness warning

**Expected Result**:
‚úÖ Staleness detection works:

- Displays "‚ö† Suggestion stale (>30 days), recomputed" in context analysis
- Does NOT show "‚úì Suggestion still valid"
- Does NOT show "Reason (from Issue Logger):"
- Shows fresh "Reason:" with current criteria evaluation
- Recomputes suggestedPath based on current project state

**Evidence**:

- Staleness warning displayed
- Fresh routing computed
- No pre-computed rationale used

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

## Test Checklist

Copy this checklist to track overall progress:

**Terminal Tests:**

- [ ] Test A: AC1 - Unified vocabulary file exists
- [ ] Test B: AC2 - Triage logic reference document exists
- [ ] Test C: AC3 - Existing v1.0 issues unchanged
- [ ] Test D: AC4-7 - Documentation contains v2.0 references
- [ ] Test E: AC5 - Issue Logger has inference logic section
- [ ] Test F: AC6 - Triage task has v2.0 detection logic
- [ ] Test G: AC10 - Triage guide has Layer 3 section

**Human Tests:**

- [ ] Test 1: AC8 - Issue Logger displays v2.0 inference prompts
- [ ] Test 2: AC8 - User can override inferred values
- [ ] Test 3: AC8 - "auto" mode skips future prompts
- [ ] Test 4: AC9 - Triage displays v2.0 fast-path for new issues
- [ ] Test 5: AC11 - Triage infers fields for v1.0 issues
- [ ] Test 6: AC9 - Staleness detection triggers recomputation

**Overall Status**: ‚¨ú Not Started | üîÑ In Progress | ‚úÖ All Passed | ‚ùå Issues Found

---

## Troubleshooting

### Issue: Terminal test commands fail with "file not found"

**Symptom**: `cat` or `grep` commands return errors
**Solution**:
- Verify working directory: `pwd` should show `.../poem-os/poem`
- Check file paths are relative to project root
- Ensure files were created in correct locations

### Issue: Agent doesn't display v2.0 prompts

**Symptom**: Issue Logger doesn't show "Inferred v2.0 fields" prompt
**Solution**:
- Verify you activated the correct agent: `/poem/log-issues`
- Check `docs/planning/gap-analysis/observation-collector.md` was updated (run Test E first)
- Ensure Claude Code session is fresh (restart if needed)

### Issue: Triage doesn't show fast-path for v2.0 issues

**Symptom**: Triage doesn't show "‚úì Suggestion still valid" message
**Solution**:
- Verify issue has `schemaVersion: "2.0"` field: `grep schemaVersion docs/planning/gap-analysis/usage-issues.jsonl`
- Ensure you logged the issue with updated agent (Tests 1-3)
- Check correct issue number being triaged

### Issue: Staleness test doesn't trigger warning

**Symptom**: Modified timestamp but no "‚ö† Suggestion stale" message
**Solution**:
- Verify timestamp is >30 days ago in ISO 8601 format: `2025-11-15T14:30:00Z`
- Ensure you're testing a v2.0 issue (has `schemaVersion` field)
- Save file after editing and verify changes: `grep "2025-11" docs/planning/gap-analysis/usage-issues.jsonl`

### Issue: v1.0 backward compatibility test fails

**Symptom**: Triage errors when processing issue-1
**Solution**:
- Verify issue-1 exists: `sed -n '1p' docs/planning/gap-analysis/usage-issues.jsonl`
- Check triage-work.md has v1.0 fallback logic (run Test F)
- Ensure issue-1 is v1.0 format (no schemaVersion field)

---

## Test Results Summary

**Date Tested**: _________________
**Tester**: _________________

**Results**:

- Terminal Tests: __ / 7 passed
- Human Tests: __ / 6 passed
- Total: __ / 13 passed

**Issues Found**:

1. _________________
2. _________________

**Sign-off**: ‚úÖ Story accepted | ‚ùå Issues require fixes

---

_Generated by Taylor (SAT Guide Creator) from Story 0.2_
