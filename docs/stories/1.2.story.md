# Story 1.2: Create poem-core Package Structure

## Status

Done

## Story

**As a** developer,
**I want** the poem-core package structured for agents, workflows, and skills,
**so that** the framework components have a clear home.

## Acceptance Criteria

1. `packages/poem-core/` follows BMAD-style structure
2. Directory structure includes: `agents/`, `workflows/`, `skills/`, `templates/`, `data/`
3. `core-config.yaml` created with basic configuration schema
4. Placeholder agent file created: `agents/prompt-engineer.md`
5. Placeholder workflow file created: `workflows/new-prompt.yaml`
6. Placeholder skill file created: `skills/check-my-prompt.md`
7. Package exports configuration files for installation

## Tasks / Subtasks

- [x] Task 1: Expand core-config.yaml with POEM configuration schema (AC: 1, 3)
  - [x] Define workspace paths section (prompts, schemas, mock-data, config)
  - [x] Define server configuration section (port, host)
  - [x] Define logging configuration section
  - [x] Add version field for POEM version tracking
  - [x] Add comments documenting each configuration option

- [x] Task 2: Verify BMAD-style directory structure exists (AC: 1, 2)
  - [x] Confirm `agents/` directory exists (created in 1.1)
  - [x] Confirm `workflows/` directory exists (created in 1.1)
  - [x] Confirm `skills/` directory exists (created in 1.1)
  - [x] Confirm `templates/` directory exists (created in 1.1)
  - [x] Confirm `data/` directory exists (created in 1.1)

- [x] Task 3: Create placeholder Prompt Engineer agent (AC: 4)
  - [x] Create `agents/prompt-engineer.md`
  - [x] Follow BMAD agent structure (YAML config + persona + commands)
  - [x] Define agent persona: name, role, style, core principles
  - [x] Define placeholder commands: `*new`, `*refine`, `*test`, `*validate`, `*help`
  - [x] Add activation instructions section
  - [x] Reference workflows and skills in dependencies

- [x] Task 4: Create placeholder new-prompt workflow (AC: 5)
  - [x] Create `workflows/new-prompt.yaml`
  - [x] Define workflow metadata (id, name, description)
  - [x] Define placeholder steps structure
  - [x] Include elicitation markers for user interaction points
  - [x] Reference outputs (prompt file, schema file)

- [x] Task 5: Create placeholder check-my-prompt skill (AC: 6)
  - [x] Create `skills/check-my-prompt.md`
  - [x] Follow POEM skill format (markdown with instructions)
  - [x] Define skill purpose and when to use
  - [x] Include placeholder validation logic description
  - [x] Reference API endpoints skill will call

- [x] Task 6: Configure package.json exports for installation (AC: 7)
  - [x] Update `packages/poem-core/package.json` with exports field
  - [x] Export core-config.yaml
  - [x] Export agents directory
  - [x] Export workflows directory
  - [x] Export skills directory
  - [x] Export templates directory
  - [x] Export data directory
  - [x] Verify exports work with `npm pack --dry-run`

- [x] Task 7: Create README.md for poem-core package
  - [x] Document package purpose
  - [x] List directory structure and contents
  - [x] Explain how agents, workflows, and skills are structured
  - [x] Reference BMAD patterns

## Dev Notes

### Previous Story Insights

[Source: Story 1.1 Completion Notes]

Story 1.1 established the monorepo foundation:
- Directory structure for poem-core already created: `agents/`, `workflows/`, `skills/`, `templates/`, `data/`
- Placeholder `core-config.yaml` exists but needs expansion with proper schema
- Package `@poem-os/core` configured in package.json
- Node 22.x, TypeScript 5.9.x, ESLint 9.x environment established

**Key files already created:**
- `packages/poem-core/package.json` - needs exports field added
- `packages/poem-core/tsconfig.json` - TypeScript config in place
- `packages/poem-core/core-config.yaml` - placeholder, needs expansion

### BMAD Agent Structure Pattern

[Source: architecture/components.md, .bmad-core/agents/]

POEM agents follow the BMAD v4 pattern. Reference `.bmad-core/agents/sm.md` for structure:

```yaml
# Agent file structure (YAML block in markdown)
activation-instructions:
  - STEP 1: Read THIS ENTIRE FILE
  - STEP 2: Adopt the persona defined below
  - STEP 3: Load core-config.yaml
  - STEP 4: Greet user and run *help

agent:
  name: [Agent Name]
  id: [agent-id]
  title: [Agent Title]
  icon: [emoji]
  whenToUse: [Description of when to use this agent]

persona:
  role: [Role description]
  style: [Interaction style]
  identity: [Who the agent is]
  focus: [Primary focus area]
  core_principles:
    - [Principle 1]
    - [Principle 2]

commands:
  - help: Show available commands
  - [command]: [Description]

dependencies:
  workflows:
    - [workflow-file.yaml]
  skills:
    - [skill-file.md]
```

### Prompt Engineer Agent Specification

[Source: architecture/components.md]

| Agent           | File                        | Primary Commands                        |
| --------------- | --------------------------- | --------------------------------------- |
| Prompt Engineer | `agents/prompt-engineer.md` | `*new`, `*refine`, `*test`, `*validate` |

**Persona:** Prompt engineering expert who guides users through systematic prompt development.

**Commands to implement (placeholder):**
- `*new` - Invoke new-prompt.yaml workflow
- `*refine` - Invoke refine-prompt.yaml workflow (placeholder reference)
- `*test` - Invoke test-prompt.yaml workflow (placeholder reference)
- `*validate` - Invoke validate-prompt.yaml workflow (placeholder reference)
- `*help` - Show available commands

### Workflow Structure Pattern

[Source: architecture/components.md]

Workflows are YAML files that define multi-step guided processes:

```yaml
id: workflow-id
name: Workflow Name
description: What this workflow does

steps:
  - id: step-1
    name: Step Name
    type: elicit | action | output
    instruction: What to do in this step
    # For elicit type:
    elicit: true
    prompt: Question to ask user
    # For action type:
    action: skill-or-api-call
    # For output type:
    output:
      file: path/to/output
      format: hbs | json | yaml

outputs:
  - name: output-name
    path: /poem/prompts/{{name}}.hbs
```

### Skill Structure Pattern

[Source: architecture/components.md]

Skills are markdown files with self-describing instructions:

```markdown
# Skill Name

## When to Use
[Description of when Claude should invoke this skill]

## What It Does
[Description of skill functionality]

## How It Works
1. [Step 1]
2. [Step 2]
3. [Step 3]

## API Calls
- `POST /api/endpoint` - [Description]

## Example Usage
[Example of skill in action]
```

### core-config.yaml Schema

[Source: architecture/unified-project-structure.md, PRD technical assumptions]

The configuration should include:

```yaml
# POEM Core Configuration
version: "1.0.0"

# Workspace paths (relative to project root after installation)
workspace:
  prompts: "/poem/prompts"
  schemas: "/poem/schemas"
  mockData: "/poem/mock-data"
  config: "/poem/config"
  workflowData: "/poem/workflow-data"

# Server configuration
server:
  port: 4321
  host: "localhost"

# Logging
logging:
  level: "info"  # debug | info | warn | error

# Hot reload (development)
hotReload:
  helpers: true
```

### Package Exports Configuration

[Source: NPM package.json exports documentation]

The exports field should map entry points:

```json
{
  "exports": {
    ".": "./core-config.yaml",
    "./agents/*": "./agents/*",
    "./workflows/*": "./workflows/*",
    "./skills/*": "./skills/*",
    "./templates/*": "./templates/*",
    "./data/*": "./data/*"
  }
}
```

### Naming Conventions

[Source: architecture/coding-standards.md]

| Element        | Convention      | Example                |
| -------------- | --------------- | ---------------------- |
| Agent files    | kebab-case.md   | `prompt-engineer.md`   |
| Workflow files | kebab-case.yaml | `new-prompt.yaml`      |
| Skill files    | kebab-case.md   | `check-my-prompt.md`   |

### Testing

[Source: architecture/testing-strategy.md]

**Test file location:** N/A for this story

**Testing approach:** Manual verification

This story creates framework documents (agents, workflows, skills) which are validated through:
- Manual activation via Claude Code slash commands (future Epic)
- Structure validation during installation (Epic 1, Story 4)

**Manual verification required:**
- `core-config.yaml` is valid YAML
- Agent, workflow, and skill files follow documented patterns
- Package exports resolve correctly (`npm pack --dry-run`)
- README.md accurately describes package contents

## Change Log

| Date       | Version | Description                           | Author            |
| ---------- | ------- | ------------------------------------- | ----------------- |
| 2025-12-23 | 0.1     | Initial story draft                   | Bob (SM Agent)    |
| 2025-12-23 | 1.0     | Story approved                        | Bob (SM Agent)    |
| 2025-12-23 | 2.0     | Implementation complete, ready for QA | James (Dev Agent) |
| 2025-12-23 | 3.0     | QA passed, story done                 | Quinn (QA Agent)  |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

None - no issues encountered during implementation.

### Completion Notes List

- All 7 tasks completed successfully
- ESLint passes with no errors
- npm pack --dry-run confirms all files included in package
- All placeholder files follow BMAD patterns from story Dev Notes
- Agent "Petra" created with prompt engineering focus
- Workflow includes 9 steps with elicitation markers
- Skill follows markdown format with API call references

### File List

**Modified:**

- `packages/poem-core/core-config.yaml` - Expanded with version, logging, workflowData, comments
- `packages/poem-core/package.json` - Added full exports field and repository info

**Created:**

- `packages/poem-core/agents/prompt-engineer.md` - Prompt Engineer agent (Petra)
- `packages/poem-core/workflows/new-prompt.yaml` - New prompt creation workflow
- `packages/poem-core/skills/check-my-prompt.md` - Prompt validation skill
- `packages/poem-core/README.md` - Package documentation

---

## QA Results

### Review Date: 2025-12-23

### Reviewed By: Quinn (Test Architect)

### Risk Assessment

**Risk Level: LOW**

- No auth/payment/security files touched
- Structural story (framework documents only, no runtime code)
- No tests required (manual verification per testing strategy)
- 7 acceptance criteria (triggers deeper review, but low inherent risk)

### Code Quality Assessment

**Overall: Excellent**

All framework documents are well-structured and follow established patterns:

1. **core-config.yaml** - Comprehensive configuration with clear comments, includes version tracking, workspace paths, server config, logging, and feature flags
2. **prompt-engineer.md** - Clean BMAD v4 agent structure with persona "Petra", 6 commands, proper dependencies
3. **new-prompt.yaml** - Well-designed 9-step workflow with elicitation markers and conditional logic
4. **check-my-prompt.md** - Complete skill format with When to Use, How It Works, API Calls, and Example Usage
5. **package.json** - Correct exports configuration with wildcard patterns
6. **README.md** - Thorough documentation covering structure, components, and usage

### Refactoring Performed

None required - implementation is clean and follows all patterns.

### Compliance Check

- Coding Standards: ✓ All files use kebab-case naming
- Project Structure: ✓ Matches unified-project-structure.md exactly
- Testing Strategy: ✓ Manual verification appropriate for framework docs
- All ACs Met: ✓ All 7 acceptance criteria verified

### Acceptance Criteria Verification

| AC | Requirement | Status | Evidence |
|----|-------------|--------|----------|
| 1 | BMAD-style structure | ✓ PASS | YAML+MD agent, YAML workflow, MD skill |
| 2 | Directory structure | ✓ PASS | agents/, workflows/, skills/, templates/, data/ |
| 3 | core-config.yaml schema | ✓ PASS | version, server, workspace, logging, features |
| 4 | agents/prompt-engineer.md | ✓ PASS | Petra persona, 6 commands, dependencies |
| 5 | workflows/new-prompt.yaml | ✓ PASS | 9 steps, elicitation, outputs |
| 6 | skills/check-my-prompt.md | ✓ PASS | Full skill format with API calls |
| 7 | Package exports | ✓ PASS | Wildcard exports for all directories |

### Improvements Checklist

All items complete - no outstanding issues:

- [x] core-config.yaml follows schema from Dev Notes
- [x] Agent follows BMAD v4 pattern
- [x] Workflow includes elicitation markers
- [x] Skill includes API call references
- [x] Package exports configured correctly
- [x] README documents all components

### Security Review

**Status: N/A**

- No runtime code, authentication, or data handling
- No secrets or credentials in configuration files
- Configuration uses localhost binding (appropriate for dev tool)

### Performance Considerations

**Status: N/A**

- Framework documents only, no runtime performance implications

### Technical Debt

**None identified.**

- Clean foundation following established patterns
- Placeholder references to future workflows/skills are appropriate

### Files Modified During Review

None - no changes required.

### Gate Status

**Gate: PASS** → docs/qa/gates/1.2-create-poem-core-package-structure.yml

### Recommended Status

**✓ Ready for Done**

All acceptance criteria met, code quality excellent, no issues found. Story can be marked as Done.
